<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Blog poster</title>
    <link rel="stylesheet" href="main.css" />
  </head>
  <body>
    <div class="title-div">
       

      <div class="form-popup" id="myForm">
        <form action="/" class="form-container" method="post">
          <h1>New Post</h1>

          <label for="title"><b>Title</b></label> <br />
          <input
            class="title-input"
            type="text"
            placeholder="Enter Title"
            name="title"
            required
          />
          <br />

          <label for="des"><b>Description</b></label> <br />
          <textarea
            class="des-input"
            name="des"
            rows="7"
            columns="50"
            required
            placeholder="Enter Description"
          ></textarea>
          <br />

          <button type="submit" class="btn">Submit</button>
          <button
            type="close"
            class="btn"
            onclick="document.getElementById('myForm').style.display='none';"
          >
            Close
          </button>
        </form>
      </div>

      <h1 class="title">Welcome!</h1>
      <input class="search" type="text"  id="search-bar" placeholder="Search" onkeyup="searchFunction()" />

      <button
        class="btn-create btn"
        onclick="document.getElementById('myForm').style.display = 'block';"
      >
        New Post
      </button>
    </div>

    <div class="posts">
      <div id="inner">
        <div class="posts-title"><h2><u>Your Posts</u></h2></div>
        <div class="empty"></div>

        <% if (locals.listy){ %> <% var l = listy %> <% len = listy.length - 1
        %> <%for (var i = len; i >= 0; i--){ %> <% let cName = "inner-post" +
        i%> 
        <div id="inner-post" class="<%=cName%> inner-post"
          >
        <div class="h3p" >
          <h3><u><em><%=listy[i].title%></em></u></h3>
          <p><%=listy[i].des%></p>
          <% let formName = 'updateForm' + i  %>

        </div>

        

          <div class="div-btns">
            <button
              id= <%=i%>
              type="update"
              class="btn-update btn"
            >
              Update
            </button>

            
          
            <form action="/delete" method="POST">
              <input type="hidden" name="index" value=<%=i%> />
              <input type="submit" class="btn" value="Delete" />
            </form>
          </div>
        </div>
        <div class="form-popup" id= <%=formName%>>
            <form action="/update" class="form-container" method="POST">
              <h1>Update Post</h1>
              <label for="title"><b>Title</b></label> <br />
              <input
                class="title-input"
                type="text"
                placeholder="Enter Title"
                name="title"
                value= "<%=listy[i]['title']%>"
    
              />
              <input type="hidden" name="index" value=<%=i%> />
              <br />
              
              <label for="des"><b>Description</b></label> <br />
              <textarea
                class="des-input"
                name="des"
                rows="7"
                columns="50"
            
                placeholder="Enter Description"
              ><%=listy[i].des%></textarea>
              <br />
   
              <button type="submit" class="btn-submit btn">Submit</button>
              <button
                type="close"
                class="btn"
                onclick="document.getElementById('updateForm').style.display='none';"
              >
                Close
              </button>
            </form>
          </div>
 
 
        
        <% }}; %>
      </div>
    </div>
    <script>

        let btns = document.querySelectorAll('.btn-update')
         
        btns.forEach(btn =>{
         btn.addEventListener('click', (e)=>{
             let need = 'updateForm' + e.target.id ;
             console.log(need)
             document.getElementById(need).style.display = 'block';
             
        })  

     })


     function searchFunction(){
        var input, filter, div, h3, txtValue;
        input = document.getElementById('search-bar');
        filter = input.value.toUpperCase();
        div = document.getElementsByClassName('inner-post');
       
        
        for (let i = 0; i < div.length; i++){
            h3 = div[i].getElementsByTagName('h3')[0];
            txtValue = h3.textContent || h3.innerText;
            if (txtValue.toUpperCase().indexOf(filter) > -1){
                div[i].style.display = '';
            } else {
                div[i].style.display = "none";
            }
        }

     }

 </script>
    
    
    
  </body>
</html>
